import{an as j,ab as _,i as O,a7 as m,aa as L,x as R,A as w,D as q,r as F,aq as M}from"./el-message-89336ba7.js";import{u as G}from"./useFetch-46b2b40f.js";import{r as x,z as U,ah as H,ac as K,d as Y,a9 as p,j as S,k as T,x as y,v as Z,T as J,y as B,a5 as E,E as V,a0 as Q,ai as W,_ as X,o as ee,R as te,f as k,q as A,u as oe,l as $,aj as se,ak as ne}from"./index-9b350966.js";function ae(t){let e;const o=x(!1),s=U({...t,originalPosition:"",originalOverflow:"",visible:!1});function r(n){s.text=n}function a(){const n=s.parent,i=c.ns;if(!n.vLoadingAddClassList){let u=n.getAttribute("loading-number");u=Number.parseInt(u)-1,u?n.setAttribute("loading-number",u.toString()):(_(n,i.bm("parent","relative")),n.removeAttribute("loading-number")),_(n,i.bm("parent","hidden"))}d(),l.unmount()}function d(){var n,i;(i=(n=c.$el)==null?void 0:n.parentNode)==null||i.removeChild(c.$el)}function f(){var n;t.beforeClose&&!t.beforeClose()||(o.value=!0,clearTimeout(e),e=window.setTimeout(g,400),s.visible=!1,(n=t.closed)==null||n.call(t))}function g(){if(!o.value)return;const n=s.parent;o.value=!1,n.vLoadingAddClassList=void 0,a()}const v=Y({name:"ElLoading",setup(n,{expose:i}){const{ns:u,zIndex:N}=j("loading");return i({ns:u,zIndex:N}),()=>{const C=s.spinner||s.svg,P=p("svg",{class:"circular",viewBox:s.svgViewBox?s.svgViewBox:"0 0 50 50",...C?{innerHTML:C}:{}},[p("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),z=s.text?p("p",{class:u.b("text")},[s.text]):void 0;return p(J,{name:u.b("fade"),onAfterLeave:g},{default:S(()=>[T(y("div",{style:{backgroundColor:s.background||""},class:[u.b("mask"),s.customClass,s.fullscreen?"is-fullscreen":""]},[p("div",{class:u.b("spinner")},[P,z])]),[[Z,s.visible]])])})}}}),l=H(v),c=l.mount(document.createElement("div"));return{...K(s),setText:r,removeElLoadingChild:d,close:f,handleAfterLeave:g,vm:c,get $el(){return c.$el}}}let b;const le=function(t={}){if(!O)return;const e=re(t);if(e.fullscreen&&b)return b;const o=ae({...e,closed:()=>{var r;(r=e.closed)==null||r.call(e),e.fullscreen&&(b=void 0)}});ce(e,e.parent,o),I(e,e.parent,o),e.parent.vLoadingAddClassList=()=>I(e,e.parent,o);let s=e.parent.getAttribute("loading-number");return s?s=`${Number.parseInt(s)+1}`:s="1",e.parent.setAttribute("loading-number",s),e.parent.appendChild(o.$el),B(()=>o.visible.value=e.visible),e.fullscreen&&(b=o),o},re=t=>{var e,o,s,r;let a;return E(t.target)?a=(e=document.querySelector(t.target))!=null?e:document.body:a=t.target||document.body,{parent:a===document.body||t.body?document.body:a,background:t.background||"",svg:t.svg||"",svgViewBox:t.svgViewBox||"",spinner:t.spinner||!1,text:t.text||"",fullscreen:a===document.body&&((o=t.fullscreen)!=null?o:!0),lock:(s=t.lock)!=null?s:!1,customClass:t.customClass||"",visible:(r=t.visible)!=null?r:!0,target:a}},ce=async(t,e,o)=>{const{nextZIndex:s}=o.vm.zIndex||o.vm._.exposed.zIndex,r={};if(t.fullscreen)o.originalPosition.value=m(document.body,"position"),o.originalOverflow.value=m(document.body,"overflow"),r.zIndex=s();else if(t.parent===document.body){o.originalPosition.value=m(document.body,"position"),await B();for(const a of["top","left"]){const d=a==="top"?"scrollTop":"scrollLeft";r[a]=`${t.target.getBoundingClientRect()[a]+document.body[d]+document.documentElement[d]-Number.parseInt(m(document.body,`margin-${a}`),10)}px`}for(const a of["height","width"])r[a]=`${t.target.getBoundingClientRect()[a]}px`}else o.originalPosition.value=m(e,"position");for(const[a,d]of Object.entries(r))o.$el.style[a]=d},I=(t,e,o)=>{const s=o.vm.ns||o.vm._.exposed.ns;["absolute","fixed","sticky"].includes(o.originalPosition.value)?_(e,s.bm("parent","relative")):L(e,s.bm("parent","relative")),t.fullscreen&&t.lock?L(e,s.bm("parent","hidden")):_(e,s.bm("parent","hidden"))},h=Symbol("ElLoading"),D=(t,e)=>{var o,s,r,a;const d=e.instance,f=n=>V(e.value)?e.value[n]:void 0,g=n=>{const i=E(n)&&(d==null?void 0:d[n])||n;return i&&x(i)},v=n=>g(f(n)||t.getAttribute(`element-loading-${W(n)}`)),l=(o=f("fullscreen"))!=null?o:e.modifiers.fullscreen,c={text:v("text"),svg:v("svg"),svgViewBox:v("svgViewBox"),spinner:v("spinner"),background:v("background"),customClass:v("customClass"),fullscreen:l,target:(s=f("target"))!=null?s:l?void 0:t,body:(r=f("body"))!=null?r:e.modifiers.body,lock:(a=f("lock"))!=null?a:e.modifiers.lock};t[h]={options:c,instance:le(c)}},ie=(t,e)=>{for(const o of Object.keys(e))Q(e[o])&&(e[o].value=t[o])},ue={mounted(t,e){e.value&&D(t,e)},updated(t,e){const o=t[h];e.oldValue!==e.value&&(e.value&&!e.oldValue?D(t,e):e.value&&e.oldValue?V(e.value)&&ie(e.value,o.options):o==null||o.instance.close())},unmounted(t){var e;(e=t[h])==null||e.instance.close()}};const de=t=>(se("data-v-c8e2d7b5"),t=t(),ne(),t),ve={class:"upload"},fe={class:"upload__tip"},ge=de(()=>$("p",null,"点击/拖拽上传图片",-1)),me={__name:"upload",setup(t){const e=R(),{loading:o,fetch:s}=G(),r=x([]);x([]);const a=async l=>{const c=[];for(let n of l){const i=new FormData;i.append("file",n);const u=await s(M,i);if(console.log(u),!u){c.push(n);continue}}console.log(c),c.length<l.length&&w.success("上传成功!")},d=l=>{if(l.preventDefault(),l.target.toggleAttribute("over",!1),o.value)return;const c=Array.from(l.dataTransfer.files);if(c.length){if(c.every(n=>!/^image/.test(n.type))){w.error("请不要上传非图片文件");return}a(c)}},f=l=>{l.preventDefault(),l.target.toggleAttribute("over",!1)},g=l=>{l.preventDefault(),l.target.toggleAttribute("over",!0)},v=async()=>{const l=await s(q,{nsfw:e.nsfw});l&&(r.value=l)};return ee(()=>{v()}),(l,c)=>{const n=te("v-icon"),i=F,u=ue;return k(),A("div",ve,[T((k(),A("div",{class:"upload__box",onDrop:d,onDragleave:f,onDragenter:g},[$("div",fe,[y(i,{size:60},{default:S(()=>[y(n,{icon:"mdi:cloud-upload-outline"})]),_:1}),ge])],32)),[[u,oe(o)]])])}}},xe=X(me,[["__scopeId","data-v-c8e2d7b5"]]);export{xe as default};
