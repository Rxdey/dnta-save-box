import{r as b,x as j}from"./el-message-6d880e39.js";/* empty css                */import{u as q}from"./useFetch-126c2fe0.js";import{u as B,e as M,q as N}from"./api-f89973af.js";import{u as R}from"./useDrag-828ece2b.js";import{a0 as V,r as i,o as z,R as A,f as l,q as r,l as s,u as a,F as m,x as p,j as x,P as g,D as T,a3 as G,aj as O,ak as P}from"./index-481bb3df.js";const H=d=>(O("data-v-27d05679"),d=d(),P(),d),J={class:"upload"},K={class:"upload__tip"},Q=H(()=>s("p",null,"点击/拖拽上传图片",-1)),W={key:0,class:"upload__status"},X={class:"upload__error-list"},Y=["src"],Z={__name:"upload",setup(d){const C=B(),{loading:$,fetch:y}=q(),L=i([]),_=i(null),u=i([]),h=i([]),v=i(0),F=async t=>{u.value=[],h.value=t,v.value=0,c.value=!0;for(let e of t){const n=new FormData;if(n.append("file",e),v.value+=1,!await y(N,n)){u.value.push(window.URL.createObjectURL(e));continue}}c.value=!1},S=t=>{const e=Array.from(t);if(e.length){if(e.every(n=>!/^image/.test(n.type))){j.error("请不要上传非图片文件");return}F(e)}},{uploadLoading:c,onDrop:D,onDragleave:k,onDragenter:w,onFileChange:I}=R(S),E=()=>{c.value||(_.value.value="",_.value.click())},U=async()=>{const t=await y(M,{nsfw:C.nsfw});t&&(L.value=t)};return z(()=>{U()}),(t,e)=>{const n=A("v-icon"),f=b;return l(),r("div",J,[s("div",{class:"upload__box",onDrop:e[0]||(e[0]=(...o)=>a(D)&&a(D)(...o)),onDragleave:e[1]||(e[1]=(...o)=>a(k)&&a(k)(...o)),onDragenter:e[2]||(e[2]=(...o)=>a(w)&&a(w)(...o)),onClick:E},[s("div",K,[a(c)?(l(),r(m,{key:1},[p(f,{size:60},{default:x(()=>[p(n,{icon:"line-md:uploading-loop"})]),_:1}),s("p",null,[s("span",null,"正在上传 "+g(v.value)+" / "+g(h.value.length),1)])],64)):(l(),r(m,{key:0},[p(f,{size:60},{default:x(()=>[p(n,{icon:"mdi:cloud-upload-outline"})]),_:1}),Q],64))])],32),u.value.length?(l(),r("div",W,g(u.value.length)+" 张上传失败",1)):T("",!0),s("div",X,[(l(!0),r(m,null,G(u.value,(o,ee)=>(l(),r("div",{class:"image-card",key:o},[s("img",{src:o,draggable:"false"},null,8,Y)]))),128))]),s("input",{type:"file",ref_key:"fileInput",ref:_,multiple:"",hidden:"",onChange:e[3]||(e[3]=(...o)=>a(I)&&a(I)(...o))},null,544)])}}},re=V(Z,[["__scopeId","data-v-27d05679"]]);export{re as default};
