import{x as b,r as j,z}from"./el-message-c7bdfc5d.js";/* empty css                */import{u as B}from"./useFetch-b66f6f31.js";import{d as M,k as N}from"./api-fc36d407.js";import{u as R}from"./useDrag-69f7d087.js";import{a0 as V,r as i,o as q,R as A,f as l,q as r,l as s,u as a,F as m,x as p,j as x,P as g,D as T,a3 as G,aj as O,ak as P}from"./index-606b5d21.js";const H=c=>(O("data-v-35c5c8a6"),c=c(),P(),c),J={class:"upload"},K={class:"upload__tip"},Q=H(()=>s("p",null,"点击/拖拽上传图片",-1)),W={key:0,class:"upload__status"},X={class:"upload__error-list"},Y=["src"],Z={__name:"upload",setup(c){const C=b(),{loading:$,fetch:y}=B(),L=i([]),_=i(null),u=i([]),h=i([]),v=i(0),F=async t=>{u.value=[],h.value=t,v.value=0,d.value=!0;for(let e of t){const n=new FormData;if(n.append("file",e),v.value+=1,!await y(N,n)){u.value.push(window.URL.createObjectURL(e));continue}}d.value=!1},S=t=>{const e=Array.from(t);if(e.length){if(e.every(n=>!/^image/.test(n.type))){z.error("请不要上传非图片文件");return}F(e)}},{uploadLoading:d,onDrop:k,onDragleave:D,onDragenter:w,onFileChange:I}=R(S),E=()=>{d.value||(_.value.value="",_.value.click())},U=async()=>{const t=await y(M,{nsfw:C.nsfw});t&&(L.value=t)};return q(()=>{U()}),(t,e)=>{const n=A("v-icon"),f=j;return l(),r("div",J,[s("div",{class:"upload__box",onDrop:e[0]||(e[0]=(...o)=>a(k)&&a(k)(...o)),onDragleave:e[1]||(e[1]=(...o)=>a(D)&&a(D)(...o)),onDragenter:e[2]||(e[2]=(...o)=>a(w)&&a(w)(...o)),onClick:E},[s("div",K,[a(d)?(l(),r(m,{key:1},[p(f,{size:60},{default:x(()=>[p(n,{icon:"line-md:uploading-loop"})]),_:1}),s("p",null,[s("span",null,"正在上传 "+g(v.value)+" / "+g(h.value.length),1)])],64)):(l(),r(m,{key:0},[p(f,{size:60},{default:x(()=>[p(n,{icon:"mdi:cloud-upload-outline"})]),_:1}),Q],64))])],32),u.value.length?(l(),r("div",W,g(u.value.length)+" 张上传失败",1)):T("",!0),s("div",X,[(l(!0),r(m,null,G(u.value,(o,ee)=>(l(),r("div",{class:"image-card",key:o},[s("img",{src:o,draggable:"false"},null,8,Y)]))),128))]),s("input",{type:"file",ref_key:"fileInput",ref:_,multiple:"",hidden:"",onChange:e[3]||(e[3]=(...o)=>a(I)&&a(I)(...o))},null,544)])}}},re=V(Z,[["__scopeId","data-v-35c5c8a6"]]);export{re as default};
