<template>
  <div class="upload">
    <div class="upload__box" @drop="onDrop" @dragleave="onDragleave" @dragenter="onDragenter" @click="onClick">
      <div class="upload__tip">
        <template v-if="!uploadLoading">
          <el-icon :size="60">
            <v-icon icon="mdi:cloud-upload-outline" />
          </el-icon>
          <p>点击/拖拽上传</p>
        </template>
        <template v-else>
          <el-icon :size="60">
            <v-icon icon="line-md:uploading-loop" />
          </el-icon>
          <p>
            <span>正在上传</span>
          </p>
        </template>
      </div>
    </div>
    <input type="file" ref="fileInput" multiple hidden @change="onFileChange">
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter, useRoute } from 'vue-router';
import { useFetch } from '@/hooks/useFetch';
import * as Server from '@/service/model/api';
import useMainStore from '@/store/modules/useMainStore';
import { useDrag } from '../upload/useDrag';

const { loading, fetch } = useFetch();
const fileInput = ref(null);

const uploadImage = async (filelist) => {
  console.log(filelist);
};
const vaildFile = (files) => {
  const fileList = Array.from(files);
  if (!fileList.length) return;
  if (fileList.every(item => !/^video/.test(item.type))) {
    ElMessage.error('请不要上传非视频文件');
    return;
  }
  uploadImage(fileList);
};
const { uploadLoading, onDrop, onDragleave, onDragenter, onFileChange } = useDrag(vaildFile);

const onClick = () => {
  if (uploadLoading.value) return;
  fileInput.value.value = '';
  fileInput.value.click();
};

</script>

<style lang="less" scoped>
@import url('../upload/index.less');
</style>
